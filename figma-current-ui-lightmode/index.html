<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TeachOnce Workflow Hub - Lightmode with Toggle</title>
    <style>
      :root {
        --ink: #173048;
        --ink-soft: #355873;
        --panel: rgba(255, 255, 255, 0.84);
        --panel-strong: rgba(255, 255, 255, 0.92);
        --stroke: rgba(23, 48, 72, 0.16);
        --primary: #1a6db6;
        --primary-hover: #145a98;
        --warm: #ea6a1a;
      }

      html[data-theme="dark"] {
        --ink: #e6edf7;
        --ink-soft: #c6d1e4;
        --panel: rgba(8, 11, 23, 0.9);
        --panel-strong: rgba(10, 14, 28, 0.94);
        --stroke: rgba(111, 92, 255, 0.36);
        --primary: #2de2e6;
        --primary-hover: #ff2a6d;
        --warm: #ff2a6d;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", "Avenir Next", "Segoe UI", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(130% 120% at 10% 100%, rgba(0, 96, 177, 0.88) 0%, rgba(0, 96, 177, 0) 46%),
          radial-gradient(110% 100% at 85% 6%, rgba(255, 126, 12, 0.9) 0%, rgba(255, 126, 12, 0) 50%),
          linear-gradient(125deg, #1d80c3 0%, #8ac1e8 30%, #ffcb4f 68%, #f66b1f 100%);
        transition: color 180ms ease, background 220ms ease;
      }

      html[data-theme="dark"] body {
        background:
          radial-gradient(circle at 15% 15%, #1a2242 0%, transparent 45%),
          radial-gradient(circle at 85% 10%, #24103f 0%, transparent 35%),
          linear-gradient(160deg, #06070d, #0b1020 55%, #090a14);
      }

      .cyber-shell {
        position: relative;
        min-height: 100vh;
        overflow: hidden;
      }

      .parallax-layer {
        position: absolute;
        inset: -8%;
        pointer-events: none;
        mix-blend-mode: soft-light;
      }

      .parallax-far {
        background: repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.12) 0, rgba(255, 255, 255, 0.12) 1px, transparent 1px, transparent 110px);
        opacity: 0.4;
      }

      .parallax-mid {
        background: radial-gradient(circle at 20% 70%, rgba(0, 90, 168, 0.3), transparent 30%), radial-gradient(circle at 82% 22%, rgba(255, 132, 26, 0.3), transparent 32%);
      }

      .parallax-near {
        background-image: linear-gradient(rgba(255, 255, 255, 0.2) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.16) 1px, transparent 1px);
        background-size: 70px 70px;
        mask-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 1));
        opacity: 0.45;
      }

      html[data-theme="dark"] .parallax-layer {
        mix-blend-mode: screen;
      }

      html[data-theme="dark"] .parallax-far {
        background-image:
          linear-gradient(to top, rgba(83, 132, 255, 0.14), transparent 45%),
          repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.04) 0,
            rgba(255, 255, 255, 0.04) 1px,
            transparent 1px,
            transparent 130px
          );
        opacity: 1;
      }

      html[data-theme="dark"] .parallax-mid {
        background-image:
          radial-gradient(circle at 20% 70%, rgba(45, 226, 230, 0.18), transparent 35%),
          radial-gradient(circle at 80% 30%, rgba(255, 42, 109, 0.16), transparent 32%);
      }

      html[data-theme="dark"] .parallax-near {
        background-image:
          linear-gradient(rgba(123, 93, 255, 0.22) 1px, transparent 1px),
          linear-gradient(90deg, rgba(123, 93, 255, 0.12) 1px, transparent 1px);
        opacity: 1;
      }

      .container {
        position: relative;
        z-index: 1;
        max-width: 1180px;
        margin: 0 auto;
        min-height: 100vh;
        padding: 40px 24px;
        display: flex;
        flex-direction: column;
      }

      .header {
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .eyebrow {
        margin: 0;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.3em;
        color: color-mix(in srgb, var(--ink) 75%, transparent);
      }

      h1 {
        margin: 10px 0 0;
        font-size: 34px;
        line-height: 1.1;
      }

      .theme-toggle {
        border: 1px solid color-mix(in srgb, var(--ink) 28%, transparent);
        background: color-mix(in srgb, var(--panel-strong) 88%, transparent);
        color: var(--ink);
        border-radius: 999px;
        height: 40px;
        padding: 4px 10px 4px 6px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .toggle-track {
        display: inline-flex;
        align-items: center;
        width: 48px;
        height: 26px;
        border-radius: 999px;
        background: color-mix(in srgb, var(--ink) 22%, transparent);
        padding: 2px;
        flex: 0 0 auto;
      }

      .toggle-knob {
        display: block;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.25);
        transition: transform 180ms ease;
      }

      html[data-theme="dark"] .toggle-knob {
        transform: translateX(22px);
      }

      .cyber-button {
        border: 1px solid color-mix(in srgb, var(--primary) 65%, #fff 10%);
        background: linear-gradient(100deg, color-mix(in srgb, var(--primary) 82%, #083f73 18%), color-mix(in srgb, var(--primary) 70%, #69c0ff 30%));
        color: #f4fbff;
        border-radius: 12px;
        padding: 11px 16px;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 12px 34px color-mix(in srgb, var(--primary) 26%, transparent);
        cursor: pointer;
      }

      html[data-theme="dark"] .cyber-button {
        border: 1px solid rgba(45, 226, 230, 0.7);
        background: linear-gradient(100deg, rgba(111, 92, 255, 0.28), rgba(45, 226, 230, 0.25));
        color: #ebfeff;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08), 0 0 18px rgba(45, 226, 230, 0.32);
      }

      .cyber-button.alt {
        background: linear-gradient(100deg, color-mix(in srgb, var(--ink) 14%, transparent), color-mix(in srgb, var(--warm) 12%, transparent));
        color: var(--ink);
        border: 1px solid color-mix(in srgb, var(--ink) 20%, transparent);
        box-shadow: none;
      }

      html[data-theme="dark"] .cyber-button.alt {
        border: 1px solid rgba(107, 114, 128, 0.65);
        background: rgba(15, 23, 42, 0.65);
        color: #cbd5e1;
      }

      .panel {
        margin-top: 18px;
        flex: 1;
        border: 1px solid var(--stroke);
        border-radius: 24px;
        background: linear-gradient(180deg, var(--panel-strong), color-mix(in srgb, var(--panel) 84%, transparent));
        backdrop-filter: blur(8px);
        box-shadow: 0 22px 70px color-mix(in srgb, var(--ink) 20%, transparent);
        padding: 32px;
      }

      html[data-theme="dark"] .panel {
        border: 1px solid rgba(111, 92, 255, 0.35);
        background: linear-gradient(180deg, rgba(8, 11, 23, 0.78), rgba(5, 8, 18, 0.9));
        box-shadow: inset 0 0 0 1px rgba(45, 226, 230, 0.14), 0 16px 60px rgba(11, 11, 33, 0.6);
      }

      .empty-state {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 22px;
      }

      .empty-state .status {
        margin: 0;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.24em;
        color: color-mix(in srgb, var(--warm) 72%, transparent);
      }

      .empty-state h2 {
        margin: 18px 0 0;
        max-width: 630px;
        font-size: 42px;
        line-height: 1.08;
      }

      .empty-state p {
        margin: 14px 0 0;
        max-width: 580px;
        color: var(--ink-soft);
        font-size: 15px;
        line-height: 1.5;
      }

      .workflow-grid {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      }

      .workflow-card {
        border: 1px solid var(--stroke);
        border-radius: 14px;
        background: color-mix(in srgb, var(--panel-strong) 95%, transparent);
        padding: 14px;
        text-align: left;
        cursor: pointer;
        color: var(--ink);
      }

      html[data-theme="dark"] .workflow-card {
        border: 1px solid rgba(111, 92, 255, 0.36);
        background: linear-gradient(170deg, rgba(15, 20, 39, 0.88), rgba(6, 9, 20, 0.9));
        box-shadow: inset 0 0 0 1px rgba(111, 92, 255, 0.16), 0 12px 30px rgba(0, 0, 0, 0.28);
      }

      .workflow-card:hover {
        transform: translateY(-2px);
      }

      .workflow-card h3 {
        margin: 8px 0;
        font-size: 20px;
      }

      .pill {
        border: 1px solid color-mix(in srgb, var(--primary) 50%, transparent);
        background: color-mix(in srgb, var(--primary) 12%, transparent);
        color: var(--ink);
        border-radius: 999px;
        padding: 4px 8px;
        font-size: 12px;
      }

      html[data-theme="dark"] .pill {
        border: 1px solid rgba(45, 226, 230, 0.4);
        background: rgba(45, 226, 230, 0.1);
        color: #b6fdff;
      }

      .muted {
        color: var(--ink-soft);
        font-size: 14px;
      }

      .hidden { display: none !important; }

      .add-screen {
        position: fixed;
        inset: 0;
        z-index: 20;
        background: color-mix(in srgb, var(--ink) 18%, rgba(255, 255, 255, 0.82));
        backdrop-filter: blur(4px);
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: auto;
      }

      html[data-theme="dark"] .add-screen {
        background: rgba(2, 6, 23, 0.78);
      }

      .add-screen-shell {
        width: 100%;
        max-width: 980px;
        display: flex;
        justify-content: center;
      }

      .run-screen {
        position: fixed;
        inset: 0;
        z-index: 30;
        background: color-mix(in srgb, var(--ink) 18%, rgba(255, 255, 255, 0.82));
        backdrop-filter: blur(4px);
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      html[data-theme="dark"] .run-screen {
        background: rgba(2, 6, 23, 0.82);
      }

      .run-shell {
        width: min(900px, 100%);
      }

      .run-content {
        border: 1px solid var(--stroke);
        border-radius: 22px;
        background: var(--panel);
        padding: 24px;
      }

      .modal {
        width: min(760px, 100%);
        border-radius: 22px;
        border: 1px solid var(--stroke);
        background: var(--panel);
        box-shadow: 0 28px 90px color-mix(in srgb, var(--ink) 34%, transparent);
        padding: 22px;
      }

      html[data-theme="dark"] .modal {
        border: 1px solid rgba(45, 226, 230, 0.3);
        background: rgba(2, 6, 23, 0.95);
        box-shadow: 0 0 60px rgba(45, 212, 191, 0.15);
      }

      .modal-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }

      .modal-head h2 {
        margin: 0;
        font-size: 24px;
      }

      .close-btn {
        border: 0;
        background: color-mix(in srgb, var(--ink) 10%, transparent);
        width: 32px;
        height: 32px;
        border-radius: 8px;
        color: var(--ink-soft);
        font-size: 16px;
        cursor: pointer;
      }

      label {
        display: block;
        margin-bottom: 7px;
        font-size: 14px;
        color: var(--ink-soft);
        font-weight: 500;
      }

      input[type="text"], textarea {
        width: 100%;
        border-radius: 10px;
        border: 1px solid color-mix(in srgb, var(--ink) 24%, transparent);
        background: color-mix(in srgb, var(--panel-strong) 90%, transparent);
        color: var(--ink);
        padding: 11px 12px;
        font-size: 14px;
      }

      textarea {
        min-height: 98px;
        resize: none;
      }

      .dropzone {
        border-radius: 12px;
        border: 1px dashed color-mix(in srgb, var(--ink) 34%, transparent);
        background: color-mix(in srgb, var(--panel-strong) 80%, transparent);
        min-height: 124px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        text-align: center;
        color: var(--ink);
        padding: 8px;
        cursor: pointer;
      }

      .dropzone small {
        margin-top: 6px;
        color: var(--ink-soft);
      }

      .form-row { margin-bottom: 14px; }

      .usecase-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 7px;
      }

      .listen-button {
        border: 1px solid color-mix(in srgb, var(--warm) 56%, transparent);
        background: color-mix(in srgb, var(--warm) 14%, transparent);
        color: color-mix(in srgb, var(--warm) 72%, #000 28%);
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 12px;
        font-weight: 600;
      }

      html[data-theme="dark"] .listen-button {
        border: 1px solid rgba(255, 42, 109, 0.55);
        background: linear-gradient(105deg, rgba(255, 42, 109, 0.24), rgba(111, 92, 255, 0.2));
        color: #f8e8ff;
      }

      .actions {
        margin-top: 16px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      @media (max-width: 820px) {
        .header { flex-direction: column; align-items: flex-start; }
        .header-right { width: 100%; justify-content: space-between; }
        .empty-state h2 { font-size: 34px; }
      }
    </style>
    <script src="https://mcp.figma.com/mcp/html-to-design/capture.js" async></script>
  </head>
  <body>
    <main class="cyber-shell min-h-screen">
      <div class="parallax-layer parallax-far" aria-hidden="true"></div>
      <div class="parallax-layer parallax-mid" aria-hidden="true"></div>
      <div class="parallax-layer parallax-near" aria-hidden="true"></div>

      <div class="container">
        <header class="header">
          <div>
            <p class="eyebrow">TeachOnce</p>
            <h1>Workflow Hub</h1>
          </div>
          <div class="header-right">
            <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle daymode and darkmode" role="switch" aria-checked="false">
              <span class="toggle-track"><span class="toggle-knob"></span></span>
              <strong id="theme-label">Daymode</strong>
            </button>
            <button id="add-workflow-top" class="cyber-button" type="button">
              <span style="font-size:20px;line-height:1">+</span>
              <span>Add Workflow</span>
            </button>
          </div>
        </header>

        <section class="panel">
          <div id="empty-state" class="empty-state">
            <p class="status">No workflows yet</p>
            <h2>Drop a process video to teach your first automation</h2>
            <p>Name the workflow, distill it in the background, then run it from this hub.</p>
            <button id="add-workflow-empty" class="cyber-button" style="margin-top:28px" type="button">Add Workflow</button>
          </div>

          <div id="workflow-grid" class="workflow-grid hidden"></div>
        </section>
      </div>

      <section id="add-screen" class="add-screen hidden">
        <div class="add-screen-shell">
        <form id="workflow-form" class="modal">
          <div class="modal-head">
            <h2>Add New Workflow</h2>
            <button id="close-modal" class="close-btn" type="button">x</button>
          </div>

          <div class="form-row">
            <label for="workflow-name">Workflow Name</label>
            <input id="workflow-name" type="text" placeholder="Booking a library meeting room" required />
          </div>

          <div class="form-row">
            <label>Upload Video</label>
            <input id="video-file" type="file" accept="video/*" class="hidden" />
            <div id="dropzone" class="dropzone">
              <div id="dropzone-title">Drag and drop your workflow video</div>
              <small id="dropzone-subtitle">or click to browse files</small>
            </div>
          </div>

          <div class="form-row">
            <div class="usecase-head">
              <label style="margin:0">Describe Your Use Case</label>
              <button id="voice-toggle" class="listen-button" type="button">Start Recording</button>
            </div>
            <textarea id="usecase-text" placeholder="Example: Log into UCI library portal, choose Science Library, select 2:00 PM to 3:00 PM, then confirm reservation."></textarea>
            <p id="voice-status" class="muted" style="margin:8px 0 0;">Voice input idle.</p>
          </div>

          <div class="actions">
            <button id="cancel-modal" class="cyber-button alt" type="button">Cancel</button>
            <button class="cyber-button" type="submit">Distill Video</button>
          </div>
        </form>
        </div>
      </section>

      <section id="run-screen" class="run-screen hidden">
        <div class="run-shell">
          <div class="run-content">
            <div class="modal-head">
              <h2 id="run-title">Run Workflow</h2>
              <button id="close-run" class="close-btn" type="button">x</button>
            </div>
            <p class="muted">You are now on the run page for this workflow.</p>
            <div style="display:flex;gap:10px;margin-top:16px;">
              <button id="back-to-hub" class="cyber-button alt" type="button">Back to Hub</button>
              <button class="cyber-button" type="button">Start Run</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const root = document.documentElement;
      const themeToggle = document.getElementById('theme-toggle');
      const themeLabel = document.getElementById('theme-label');
      const addScreen = document.getElementById('add-screen');
      const addWorkflowTop = document.getElementById('add-workflow-top');
      const addWorkflowEmpty = document.getElementById('add-workflow-empty');
      const closeModal = document.getElementById('close-modal');
      const cancelModal = document.getElementById('cancel-modal');
      const workflowForm = document.getElementById('workflow-form');
      const workflowName = document.getElementById('workflow-name');
      const workflowGrid = document.getElementById('workflow-grid');
      const emptyState = document.getElementById('empty-state');
      const dropzone = document.getElementById('dropzone');
      const videoFile = document.getElementById('video-file');
      const dropzoneTitle = document.getElementById('dropzone-title');
      const dropzoneSubtitle = document.getElementById('dropzone-subtitle');
      const voiceToggle = document.getElementById('voice-toggle');
      const voiceStatus = document.getElementById('voice-status');
      const usecaseText = document.getElementById('usecase-text');
      const runScreen = document.getElementById('run-screen');
      const runTitle = document.getElementById('run-title');
      const closeRun = document.getElementById('close-run');
      const backToHub = document.getElementById('back-to-hub');

      let recognition = null;
      let listening = false;

      function nowLabel() {
        return new Date().toLocaleString();
      }

      function openModal() {
        addScreen.classList.remove('hidden');
      }

      function closeModalFn() {
        addScreen.classList.add('hidden');
      }

      function openRunScreen(name, id) {
        runTitle.textContent = `Run: ${name}`;
        window.location.hash = `run/${id}`;
        runScreen.classList.remove('hidden');
      }

      function closeRunScreen() {
        runScreen.classList.add('hidden');
        if (window.location.hash.startsWith('#run/')) {
          history.replaceState(null, '', window.location.pathname + window.location.search);
        }
      }

      function updateTheme() {
        const isDark = root.getAttribute('data-theme') === 'dark';
        themeToggle.setAttribute('aria-checked', String(isDark));
        themeLabel.textContent = isDark ? 'Darkmode' : 'Daymode';
      }

      themeToggle.addEventListener('click', () => {
        const isDark = root.getAttribute('data-theme') === 'dark';
        root.setAttribute('data-theme', isDark ? 'light' : 'dark');
        updateTheme();
      });

      addWorkflowTop.addEventListener('click', openModal);
      addWorkflowEmpty.addEventListener('click', openModal);
      closeModal.addEventListener('click', closeModalFn);
      cancelModal.addEventListener('click', closeModalFn);

      dropzone.addEventListener('click', () => videoFile.click());

      videoFile.addEventListener('change', () => {
        const file = videoFile.files && videoFile.files[0];
        if (!file) return;
        dropzoneTitle.textContent = file.name;
        dropzoneSubtitle.textContent = 'Click to replace video';
      });

      workflowForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const name = workflowName.value.trim();
        if (!name) return;

        const workflowId = crypto.randomUUID();
        const card = document.createElement('button');
        card.type = 'button';
        card.className = 'workflow-card';
        card.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <p style="margin:0;font-size:12px;letter-spacing:.18em;text-transform:uppercase;color:var(--ink-soft)">Workflow</p>
            <span class="pill">ready</span>
          </div>
          <h3>${name.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</h3>
          <p class="muted">Updated ${nowLabel()}</p>
        `;
        card.addEventListener('click', () => openRunScreen(name, workflowId));

        workflowGrid.prepend(card);
        workflowGrid.classList.remove('hidden');
        emptyState.classList.add('hidden');

        workflowForm.reset();
        dropzoneTitle.textContent = 'Drag and drop your workflow video';
        dropzoneSubtitle.textContent = 'or click to browse files';
        closeModalFn();
      });

      function setupVoiceInput() {
        const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!Recognition) {
          voiceToggle.textContent = 'Voice Unavailable';
          voiceToggle.disabled = true;
          voiceStatus.textContent = 'Voice input not supported in this browser.';
          return;
        }

        recognition = new Recognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'en-US';

        recognition.onresult = (event) => {
          let text = '';
          for (let i = event.resultIndex; i < event.results.length; i += 1) {
            const result = event.results[i];
            text += result[0].transcript;
          }
          usecaseText.value = `${usecaseText.value} ${text}`.trim();
        };

        recognition.onend = () => {
          listening = false;
          voiceToggle.textContent = 'Start Recording';
          voiceStatus.textContent = 'Voice input idle.';
        };

        voiceToggle.addEventListener('click', () => {
          if (!recognition) return;
          if (listening) {
            recognition.stop();
            return;
          }
          recognition.start();
          listening = true;
          voiceToggle.textContent = 'Stop Recording';
          voiceStatus.textContent = 'Recording... speak now.';
        });
      }

      closeRun.addEventListener('click', closeRunScreen);
      backToHub.addEventListener('click', closeRunScreen);

      if (window.location.hash.startsWith('#run/')) {
        runScreen.classList.remove('hidden');
      }

      setupVoiceInput();
      updateTheme();
    </script>
  </body>
</html>
